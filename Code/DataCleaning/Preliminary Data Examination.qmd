---
title: "Preliminary Data Examination"
author: "Marliese Baer"
format: html
editor: visual
---

## Set Up
```{r}
#| warning: false

rm(list = ls())
library(tidyverse)
library(here)
library(ggfortify)
library(readr)
library(lubridate)
```

## Pull in original data
```{r}
Cape_May <- read.csv(here("Data", "HawkWatch Data Uncleaned csv", "Cape_May.csv"))
Goshute_Mtns <- read.csv(here("Data", "HawkWatch Data Uncleaned csv", "Goshute_Mtns.csv"))
Hawk_Ridge <- read.csv(here("Data", "HawkWatch Data Uncleaned csv", "Hawk_Ridge.csv"))

#Cape_May
#Goshute_Mtns
#Hawk_Ridge
```

## Tidying

### Tidying the Cape May data set

```{r}
Cape_May <- read.csv(here("Data", "HawkWatch Data Uncleaned csv", "Cape_May.csv"), na = c("NA"))

newnamesCM <- paste(Cape_May[3, ], Cape_May[4, ])

Cape_May <- Cape_May |>
  set_names(newnamesCM) |>
  slice(-1, -2, -3, -4, -5)

CM_clean <- Cape_May |>
  pivot_longer(c(6:30), names_to = "Species_age",
               values_to = "n_spp") |>
  separate(Species_age, c("Species", "Age"),
           sep = " ") |>
  filter(Species == "RT" | Species == "SS" | Species == "CH" | Species == "AK" | Species == "PG") |>
  mutate(Date = dmy(`Date `)) |>
  mutate(n_individ = as.double(n_spp)) |>
  mutate(Species = as.factor(Species)) |>
  group_by(Date, Species) |>
  mutate(total_n = sum(n_individ)) |>
  mutate(Duration = as.double(`Duration (min)`))|>
  filter(Duration > 0 & Duration < 1000) |>
  group_by(Date, Species) |>
  mutate(duration_min_day = sum(Duration)) |>
  mutate(year = year(Date)) |>
  mutate(month = month(Date, label = TRUE)) |>
  mutate(wday = wday(Date, label = TRUE)) |>
  select(Date, Species, Duration, n_individ, total_n, duration_min_day, year, month, wday)

##added filter(Duration > 0 & Duration < 1000) as a temporary fix to outlier problem. Will address more seriously after NENHC

CM_clean <- CM_clean |> 
  group_by(Date, Species) |>
  mutate(individ_per_min = mean(total_n/duration_min_day)) |>
  mutate(individ_per_hour = individ_per_min*60) |>
  mutate(week = week(Date))

write.csv(CM_clean, here("Data","Processed Data","CM_clean.csv"), row.names = FALSE) #row.names=FALSE means please don't make X column where it has numbered the rows

```


### Tidying the Goshutes data set
```{r}
Goshute_Mtns_2 <- read.csv(here("Data", "HawkWatch Data Uncleaned csv", "Goshute_Mtns.csv"), na = c("NA"), skip = 3) |> slice(-(1))
head(Goshute_Mtns_2)

GM_clean <- Goshute_Mtns_2 |>
  pivot_longer(c(6:28), names_to = "Species",
               values_to = "n_spp") |>
  filter(Species == "RT" | Species == "SS" | Species == "CH" | Species == "AK" | Species == "PG") |>
  mutate(Date = dmy(Date)) |>
  select(Date, everything()) |>
  mutate(n_individ = as.double(n_spp)) |>
  mutate(Species = as.factor(Species)) |>
  group_by(Date, Species) |>
  mutate(total_n = sum(n_individ)) |>
  mutate(Duration = as.double(Duration))|>
  filter(Duration > 0 & Duration < 1000) |>
  group_by(Date, Species) |>
  mutate(duration_min_day = sum(Duration)) |>
  mutate(year = year(Date)) |>
  mutate(month = month(Date, label = TRUE)) |>
  mutate(wday = wday(Date, label = TRUE)) |>
  select(Date, Species, Duration, n_individ, total_n, duration_min_day, year, month, wday)

##added filter(Duration > 0 & Duration < 1000) as a temporary fix to outlier problem. Will address more seriously after NENHC

GM_clean <- GM_clean |> 
  group_by(Date, Species) |>
  mutate(individ_per_min = mean(total_n/duration_min_day)) |>
  mutate(individ_per_hour = individ_per_min*60) |>
  mutate(week = week(Date))

write.csv(GM_clean, here("Data","Processed Data","GM_clean.csv"), row.names = FALSE) #row.names=FALSE means please don't make X column where it has numbered the rows

```


### Tidying Hawk Ridge
```{r}
Hawk_Ridge <- read.csv(here("Data", "HawkWatch Data Uncleaned csv", "Hawk_Ridge.csv"), na = c("NA"))

newnamesHR <- paste(Hawk_Ridge[3, ], Hawk_Ridge[4, ])

Hawk_Ridge <- Hawk_Ridge |>
  set_names(newnamesHR) |>
  slice(-1, -2, -3, -4)

### now clean the data

HR_clean <- Hawk_Ridge |>
  pivot_longer(c(6:87), names_to = "Species_age",
               values_to = "n_spp") |>
  separate(Species_age, c("Species", "Age"),
           sep = " ") |>
  filter(Species == "RT" | Species == "SS" | Species == "CH" | Species == "AK" | Species == "PG") |>
  mutate(Date = dmy(`Date `)) |>
  select(Date, everything()) |>
  mutate(n_individ = as.double(n_spp)) |>
  mutate(Species = as.factor(Species)) |>
  group_by(Date, Species) |>
  mutate(total_n = sum(n_individ)) |>
  mutate(Duration = as.double(`Duration (min)`))|>
  filter(Duration > 0 & Duration < 1000) |>
  group_by(Date, Species) |>
  mutate(duration_min_day = sum(Duration)) |>
  mutate(year = year(Date)) |>
  mutate(month = month(Date, label = TRUE)) |>
  mutate(wday = wday(Date, label = TRUE)) |>
  select(Date, Species, Duration, n_individ, total_n, duration_min_day, year, month, wday)

##added filter(Duration > 0 & Duration < 1000) as a temporary fix to outlier problem. Will address more seriously after NENHC

HR_clean <- HR_clean |> 
  group_by(Date, Species) |>
  mutate(individ_per_min = mean(total_n/duration_min_day)) |>
  mutate(individ_per_hour = individ_per_min*60) |>
  mutate(week = week(Date))

write.csv(HR_clean, here("Data","Processed Data","HR_clean.csv"), row.names = FALSE) #row.names=FALSE means please don't make X column where it has numbered the rows

```



## notes on data cleaning:
emit row 1

pivot_longer() -> make spp a column


what i want cape may:
column date (julian date)
column time (number of hours per day)
column spp - only 5 species (w number of species sighted)


what i want hawk ridge and goshutes:
keep only 5 spp
combine all ages
column date
column time

standardize by hours observed/day

move columns to the start of df
make df only have columns you want.


